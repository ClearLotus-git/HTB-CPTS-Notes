#### Detailed Checklist for AD Pentesting

Below is the complete checklist, organized by stage, with specific commands, tools, and actions. This ensures coverage of all critical areas, from initial enumeration to final exfiltration.

##### 1. Reconnaissance

This stage involves gathering information about the AD environment to understand its structure and potential entry points. Tools like PowerView, AD Module, and BloodHound are essential, as seen in the GitHub cheat sheet.

- 1. - [ ]  Enumerate domain information
    
    - Use Get-Domain (PowerView)
    - Use Get-ADDomain (AD Module)
- 2. - [ ]  Enumerate users
    
    - Use Get-DomainUser (PowerView)
    - Use Get-ADUser (AD Module)
- 3. - [ ]  Enumerate groups
    
    - Use Get-DomainGroup (PowerView)
    - Use Get-ADGroup (AD Module)
- 4. - [ ]  Enumerate computers
    
    - Use Get-DomainComputer (PowerView)
    - Use Get-ADComputer (AD Module)
- 5. - [ ]  Identify domain controllers
    
    - Use Get-DomainController (PowerView)
- 6. - [ ]  Map domain trusts
    
    - Use Get-DomainTrust (PowerView)
- 7. - [ ]  Use BloodHound for comprehensive enumeration
    
    - Run bloodhound-python -u <UserName> -p <Password> -ns <DC IP> -d <Domain> -c All

BloodHound, in particular, creates graphical representations of attack paths, as noted in [HackTheBox: Active directory pentesting: cheatsheet and beginner guide](https://www.hackthebox.com/blog/active-directory-penetration-testing-cheatsheet-and-guide), enhancing visibility into potential exploitation routes.

##### 2. Initial Access

Gaining initial access is crucial, often through password spraying, exploiting vulnerabilities, or social engineering. Ethical considerations are vital, especially for methods like phishing, which must align with engagement rules.

- 8. - [ ]  Perform password spraying
    
    - Use DomainPasswordSpray tool
- 9. - [ ]  Exploit known vulnerabilities in AD services
    
    - Check for vulnerabilities like Zerologon, PrintNightmare, etc., as listed in the GitHub cheat sheet
- 10. - [ ]  Use phishing to obtain credentials
    
    - (Note: Ensure compliance with ethical guidelines and engagement scope)

##### 3. Execution

Once access is gained, execute commands to interact with the environment, using tools like PowerShell or Impacket for remote execution.

- 11. - [ ]  Execute commands on compromised machines
    
    - Use Invoke-Command (PowerShell)
    - Use psexec, wmiexec, etc. from Impacket

##### 4. Persistence

Establishing persistence ensures continued access, using methods like backdoor accounts or golden tickets, as detailed in the GitHub cheat sheet under exploitation techniques.

- 12. - [ ]  Create backdoor accounts
    
    - Add users to privileged groups
- 13. - [ ]  Install persistence mechanisms
    
    - Scheduled tasks, services, etc.
- 14. - [ ]  Use golden tickets for persistent access
    
    - Use Mimikatz: kerberos::golden

##### 5. Privilege Escalation

Elevate privileges to gain higher access, exploiting misconfigurations like unconstrained delegation or performing Kerberoasting, as seen in the cheat sheet.

- 15. - [ ]  Check for local admin privileges
    
    - Use Get-LocalAdmin (PowerView)
- 16. - [ ]  Exploit unconstrained delegation
    
    - Use Get-DomainComputer -Unconstrained (PowerView)
- 17. - [ ]  Perform Kerberoasting
    
    - Use Rubeus.exe kerberoast /outfile:<file> /domain:<domain>
- 18. - [ ]  Abuse misconfigured ACLs
    
    - Use Get-ObjectAcl (PowerView)

##### 6. Defense Evasion

Avoid detection by evading security measures, such as disabling antivirus or using obfuscated scripts, which is critical for maintaining access.

- 19. - [ ]  Disable or evade antivirus
    
    - (Specific techniques depend on the environment)
- 20. - [ ]  Use obfuscated scripts
    
    - Encode PowerShell commands

##### 7. Credential Access

Extract credentials for further exploitation, using tools like Mimikatz for memory dumping or Impacket for SAM database extraction.

- 21. - [ ]  Dump credentials from memory
    
    - Use Mimikatz: sekurlsa::logonpasswords
- 22. - [ ]  Extract credentials from SAM database
    
    - Use secretsdump.py from Impacket
- 23. - [ ]  Perform pass-the-hash attacks
    
    - Use psexec.py with hash

##### 8. Discovery

Identify sensitive systems and data within the network, using tools like BloodHound for attack path mapping and PowerView for share enumeration.

- 24. - [ ]  Identify sensitive data and systems
    
    - Use BloodHound to find paths to high-value targets
- 25. - [ ]  Enumerate shares and permissions
    
    - Use Find-DomainShare (PowerView)

##### 9. Lateral Movement

Move through the network using stolen credentials or exploiting trust relationships, essential for expanding the attack surface.

- 26. - [ ]  Use stolen credentials to access other machines
    
    - Use Enter-PSSession, psexec, etc.
- 27. - [ ]  Exploit trust relationships
    
    - Move between trusted domains
- 28. - [ ]  Use remote execution tools
    
    - WMI, PsExec, etc.

##### 10. Collection and Exfiltration

Gather and extract sensitive data, completing the mission by accessing file shares or using exfiltration methods like DNS tunneling.

- 29. - [ ]  Collect sensitive data
    
    - Access file shares, databases, etc.
- 30. - [ ]  Exfiltrate data
    
    - Use various methods like DNS, HTTP, etc.

#### Tools and Resources

The checklist leverages various tools, as detailed in [CyberSecurityNews: Active Directory Attack Kill Chain Checklist & Tools List- 2024](https://cybersecuritynews.com/active-directory-checklist/), including BloodHound, Mimikatz, Rubeus, and PowerView. The GitHub cheat sheet also lists additional tools like Certify for certificate abuse and CrackMapExec for network pentesting, ensuring comprehensive coverage.

#### Ethical and Practical Considerations

An important aspect is ethical considerations, especially for initial access methods like phishing, which must align with engagement rules. The checklist is adaptable, allowing testers to modify actions based on the specific environment and scope, ensuring compliance with legal and organizational policies.

#### Table: Summary of Key Tools by Stage

Below is a table summarizing key tools used in each stage, enhancing the checklistâ€™s usability.

|**Stage**|**Key Tools**|**Example Command/Action**|
|---|---|---|
|Reconnaissance|PowerView, BloodHound, AD Module|Get-DomainUser, bloodhound-python -c All|
|Initial Access|DomainPasswordSpray, Impacket|Password spraying, psexec.py|
|Execution|PowerShell, Impacket|Invoke-Command, wmiexec|
|Persistence|Mimikatz|kerberos::golden|
|Privilege Escalation|Rubeus, PowerView|Rubeus.exe kerberoast, Get-ObjectAcl|
|Defense Evasion|Custom scripts|Encode PowerShell commands|
|Credential Access|Mimikatz, Impacket|sekurlsa::logonpasswords, secretsdump.py|
|Discovery|BloodHound, PowerView|Find attack paths, Find-DomainShare|
|Lateral Movement|PsExec, WMI|Enter-PSSession, remote execution|
|Collection/Exfiltration|Various (DNS, HTTP)|Access shares, exfiltrate via DNS|